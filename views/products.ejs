<!DOCTYPE html>
<html>
<head>
<title>Products - GLOM Authorization</title>
<link rel="stylesheet" href="/glom.css">
</head>
<body class="dash-bg">
<div id="mouse-glow"></div>
<script src="/glom.js"></script>
<div class="sidebar">
  <h3>GLOM</h3>
  <ul>
    <li onclick="location.href='/dashboard'">Dashboard</li>
    <li onclick="location.href='/create'">Create</li>
    <li onclick="location.href='/keys'">Keys</li>
    <li onclick="location.href='/products'">Products</li>
    <li onclick="location.href='/sources'">Sources</li>
    <li onclick="location.href='/panels'">Panels</li>
    <li onclick="location.href='/api'">API</li>
    <li onclick="location.href='/logs'">Logs</li>
    <li onclick="location.href='/settings'">Settings</li>
  </ul>
</div>
<div class="dashboard-area">
<h2>Products Manager</h2>
<button class="generate-btn" onclick="openAdd()">Add Product</button>
<table id="table"></table>
</div>

<div id="addModal" class="modal-bg">
 <div class="glass-card" style="width:380px;">
  <h3>Add Product</h3>
  <input class="glass-input" id="pname" placeholder="Product Name">
  <select class="glass-input" id="ptype">
    <option value="KEY">KEY Based</option>
    <option value="USERPASS">USER/PASS Based</option>
  </select>
  <input class="glass-input" id="papi" placeholder="API Name (ex: cod-cheat)">
  <select class="glass-input" id="pduration">
    <option value="1h">1 Hour</option>
    <option value="1d">1 Day</option>
    <option value="7d">7 Days</option>
    <option value="30d">30 Days</option>
    <option value="lifetime">Lifetime</option>
  </select>
  <select class="glass-input" id="phwid">
    <option value="1">1 Device</option>
    <option value="2">2 Devices</option>
    <option value="3">3 Devices</option>
    <option value="99">Unlimited</option>
  </select>
  <select class="glass-input" id="preset">
    <option value="0">No Reset</option>
    <option value="1">1 Time</option>
    <option value="3">3 Times</option>
    <option value="10">10 Times</option>
    <option value="99">Unlimited</option>
  </select>
  <select class="glass-input" id="psource">
    <option value="true">Allow SOURCE Sell</option>
    <option value="false">Deny SOURCE Sell</option>
  </select>
  <select class="glass-input" id="ppanel">
    <option value="true">Allow PANEL Sell</option>
    <option value="false">Deny PANEL Sell</option>
  </select>
  <button class="generate-btn" onclick="saveProduct()">Save</button>
  <button class="generate-btn" style="background:#444;" onclick="closeAdd()">Cancel</button>
 </div>
</div>

<script>
const token = localStorage.getItem("glom_token");
if(!token) location.href="/login";

function openAdd(){ document.getElementById("addModal").style.display="flex"; }
function closeAdd(){ document.getElementById("addModal").style.display="none"; }

async function saveProduct(){
  const p = {
    name: document.getElementById("pname").value,
    creationType: document.getElementById("ptype").value,
    apiName: document.getElementById("papi").value,
    defaultDuration: document.getElementById("pduration").value,
    hwidLimit: document.getElementById("phwid").value,
    resetLimit: document.getElementById("preset").value,
    allowSourceSell: document.getElementById("psource").value==="true",
    allowPanelSell: document.getElementById("ppanel").value==="true"
  };
  await fetch("/product/add",{
    method:"POST",
    headers:{ "Content-Type":"application/json","Authorization":"Bearer "+token },
    body: JSON.stringify(p)
  });
  closeAdd();
  loadProducts();
}

async function toggleProduct(name){
  await fetch("/product/toggle",{
    method:"POST",
    headers:{ "Content-Type":"application/json","Authorization":"Bearer "+token },
    body: JSON.stringify({ name })
  });
  loadProducts();
}

async function deleteProduct(name){
  await fetch("/product/delete",{
    method:"POST",
    headers:{ "Content-Type":"application/json","Authorization":"Bearer "+token },
    body: JSON.stringify({ name })
  });
  loadProducts();
}

async function loadProducts(){
  const res = await fetch("/product/list",{
    headers:{ "Authorization":"Bearer "+token }
  });
  const data = await res.json();
  const table = document.getElementById("table");
  table.innerHTML = `
  <tr>
    <th>Name</th><th>Type</th><th>Duration</th><th>HWID Limit</th>
    <th>Reset Limit</th><th>Source</th><th>Panel</th><th>Status</th><th>Actions</th>
  </tr>`;
  data.forEach(p=>{
    table.innerHTML += `
      <tr>
        <td>${p.name}</td>
        <td>${p.creationType}</td>
        <td>${p.defaultDuration}</td>
        <td>${p.hwidLimit}</td>
        <td>${p.resetLimit}</td>
        <td>${p.allowSourceSell}</td>
        <td>${p.allowPanelSell}</td>
        <td>${p.disabled?"Disabled":"Active"}</td>
        <td>
          <button class="generate-btn" onclick="toggleProduct('${p.name}')">Enable/Disable</button>
          <button class="generate-btn" style="background:#700" onclick="deleteProduct('${p.name}')">Delete</button>
        </td>
      </tr>`;
  });
}
loadProducts();
</script>
</body>
</html>

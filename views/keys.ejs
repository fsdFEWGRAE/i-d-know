<!DOCTYPE html>
<html>
<head>
<title>Keys - GLOM Authorization</title>
<link rel="stylesheet" href="/glom.css">
</head>
<body class="dash-bg">
<div id="mouse-glow"></div>
<script src="/glom.js"></script>
<div class="sidebar">
  <h3>GLOM</h3>
  <ul>
    <li onclick="location.href='/dashboard'">Dashboard</li>
    <li onclick="location.href='/create'">Create</li>
    <li onclick="location.href='/keys'">Keys</li>
    <li onclick="location.href='/products'">Products</li>
    <li onclick="location.href='/sources'">Sources</li>
    <li onclick="location.href='/panels'">Panels</li>
    <li onclick="location.href='/api'">API</li>
    <li onclick="location.href='/logs'">Logs</li>
    <li onclick="location.href='/settings'">Settings</li>
  </ul>
</div>
<div class="dashboard-area">
<h2>Keys Manager</h2>
<table id="table"></table>
</div>
<script>
const token = localStorage.getItem("glom_token");
if(!token) location.href="/login";

async function action(key, act){
  await fetch("/keys/action",{
    method:"POST",
    headers:{ "Content-Type":"application/json","Authorization":"Bearer "+token },
    body: JSON.stringify({ key, action:act })
  });
  loadKeys();
}

async function loadKeys(){
  const res = await fetch("/keys/list",{ headers:{ "Authorization":"Bearer "+token }});
  const data = await res.json();
  const table = document.getElementById("table");
  table.innerHTML = `
  <tr>
    <th>Key</th><th>Product</th><th>Status</th><th>Expires</th><th>HWID</th><th>Used</th><th>Actions</th>
  </tr>`;
  data.forEach(k=>{
    table.innerHTML += `
      <tr>
        <td>${k.key}</td>
        <td>${k.product}</td>
        <td>${k.status}</td>
        <td>${k.expiresAt?new Date(k.expiresAt).toLocaleDateString():"-"}</td>
        <td>${(k.hwid||"").substring(0,16)}</td>
        <td>${k.usedCount}</td>
        <td>
          <button class="generate-btn" onclick="action('${k.key}','activate')">Activate</button>
          <button class="generate-btn" style="background:#aa7700" onclick="action('${k.key}','suspend')">Suspend</button>
          <button class="generate-btn" style="background:#700" onclick="action('${k.key}','ban')">Ban</button>
          <button class="generate-btn" style="background:#333" onclick="action('${k.key}','reset_hwid')">Reset HWID</button>
        </td>
      </tr>`;
  });
}
loadKeys();
</script>
</body>
</html>
